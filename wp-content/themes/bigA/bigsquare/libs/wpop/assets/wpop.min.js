/**
 * Wordspop core
 * Version 1.1
 *
 * Copyright (c) 2011 Wordspop
 * Licensed under the Apache License, Version 2.0 http://www.apache.org/licenses/LICENSE-2.0
 */
(function(a){WPop_Nav={init:function(){var b=this;a("a","#wpop-nav").each(function(d){var c=a(this).attr("href");a(this).bind("click",function(){b.current(this);return false});if(d==0){a(this).parent("li").addClass("current")}else{if(d==1){a(this).parent("li").addClass("alt");a(c).hide()}else{a(c).hide()}}});a("#wpop-container").fadeIn("fast",function(){a("#wpop-content").css("min-height",a("#wpop-sidebar").height())})},current:function(c){var d=a("div.context:visible","#wpop-content");var b=a(c).parent("li").next();a(d).fadeOut("fast",function(){a("li","#wpop-nav").removeClass("current alt");a(c).parent("li").addClass("current");if(b.length>0){b.addClass("alt")}a(a(c).attr("href")).fadeIn("fast")})}};WPop_ColorPicker={current:"",init:function(){a(".wpop-colorpicker").ColorPicker({onBeforeShow:function(c){WPop_ColorPicker.current=this;var b=a(this).children("div").css("backgroundColor");if(b=="transparent"){b="#ffffff"}a(this).ColorPickerSetColor(WPop_ColorPicker.fixRGB(b))},onShow:function(b){a(b).fadeIn("fast");return false},onHide:function(b){a(b).fadeOut("fast");return false},onChange:function(b,d,c){if(d=="NaNNaNNaN"){return}a(WPop_ColorPicker.current).children("div").css("backgroundColor","#"+d);a(WPop_ColorPicker.current).next("input").attr("value","#"+d)}});a(".wpop-color").bind("change keypress",function(){try{a(this).prev("div").children("div").animate({backgroundColor:a(this).val()},"fast")}catch(b){a(this).prev("div").children("div").css("backgroundColor",a(this).val())}})},fixRGB:function(b){var c=b.replace(/rgb\(|rgba\(|\)/g,"").split(",");color={r:parseInt(c[0]),g:parseInt(c[1]),b:parseInt(c[2]),a:1};if(c[3]!=null){color.a=parseFloat(c[3])}return color},RGBToHex:function(b){if(typeof(b)=="string"){var c=this.fixRGB(b)}else{var c=b}if(c.a!=null&&c.a==0){return""}var d=[c.r.toString(16),c.g.toString(16),c.b.toString(16)];a.each(d,function(e,f){if(f.length==1){d[e]="0"+f}});return d.join("")},HexToRGB:function(b){var b=parseInt(((b.indexOf("#")>-1)?b.substring(1):b),16);return{r:b>>16,g:(b&65280)>>8,b:(b&255)}},maybeHEX:function(b){if(b.match(/^#/g)){return this.HexToRGB(b)}return b}};WPop_Uploader={init:function(){a(".upload-remove").bind("click",function(){WPop_Uploader.remove(this)});a(".upload-button").click(function(){var d=this;var b=a(this).prev("input");var c=0;var e=a(a(this).parents(".option").get(0)).prev("h3").text();if(a("#post_ID").length>0){c=a("#post_ID").val()}else{c=a(this).next("input").val()}if(e==""){e="Add Media"}tb_show(e,"media-upload.php?post_id="+c+"&amp;type=image&amp;TB_iframe=1");window.send_to_editor=function(g){tb_remove();var f=a("img",g).attr("src");a(b).val(f);WPop_Uploader.display(b)};return false})},display:function(b){var c=a(b).nextAll("div");c.html('<div style="display: none;"><a href="'+a(b).val()+'" class="upload-fullsize" target="_blank" title="View full size"><img src="'+a(b).val()+'" /></a><a href="#" class="upload-remove" title="Remove">Remove</a></div>');a("div",c).fadeIn();a(".upload-remove",c).bind("click",function(){WPop_Uploader.remove(this);return false})},remove:function(b){var c=a(b).parents(".input").get(0);a(".upload-preview div",c).fadeOut("fastx",function(){a(this).remove();a(".upload-value",c).val("")})}};WPop_Scheme={init:function(){a(".scheme").click(function(){WPop_Scheme.set(a(this).attr("id").substring(7));return false})},set:function(b){a(".section-scheme .current").fadeOut("fast",function(){a(".section-scheme .current").appendTo("#scheme-"+b).fadeIn("fast");a(".section-scheme input").val(b)})}};a.fn.WPopSelector=function(){this.each(function(){var g=[];var h=a("input.wpop-selector-entries-value",this);var c=a(".wpop-selector-action a",this);var k=a(".wpop-selector-entries",this);var f=a("ul",this);var d=a("select",this);var i=a(".ajax-feedback",this);f.sortable({update:function(m,n){e(this)}});k.hide();if(a(".wpop-selector-source",this).attr("type")=="radio"){var b=a(":checked",this).val()}else{var b=a(".wpop-selector-source",this).val()}l({action:"wpop_get_selector_options",source:b});a(":input.wpop-selector-source",this).bind("click",function(){var m={action:"wpop_get_selector_options",source:a(this).val()};a("li",f).fadeOut("fast",function(){f.empty()});l(m)});a("input[type=button]",this).bind("click",function(){if(k.css("display")=="none"){c.trigger("click")}var n=a(":selected",d);var m=a("#wpop-selector-entry").clone().attr("id","").show();a("h4",m).html(n.text());a(".wpop-selector-entry-value",m).text(n.val());m=a("<li></li>").wrapInner(m);m.hide().addClass("widget").appendTo(f);m.fadeIn();a(".widget-action",m).bind("click",function(){j(this);return false});e()});a(".widget-action",a("li",f)).bind("click",function(){j(this);return false});c.click(function(){f.parent(".wpop-selector-entries").slideToggle();return false});function l(m){d.empty();i.css("visibility","visible");a.getJSON(ajaxurl,m,function(n){i.css("visibility","hidden");a.each(n,function(q,p){var o=a('<option value="'+q+'">'+p+"</option>");o.appendTo(d)})})}function e(){g=[];a(".wpop-selector-entry-value",f).each(function(){g.push(a(this).text())});h.val(g.join(","))}function j(m){a(a(m).parents("li").get(0)).fadeOut("normal",function(){a(this).remove();e()})}})};WPop_ThemeOptions={init:function(){var b=this;a("#wpop-theme-settings").submit(function(){var c=a("#wpop-theme-import","#wpop-theme-settings").val();if(c!=""){b.doImport(c);return false}WPop.flashMessage("Saving theme settings, please wait &hellip;","loading");a.post("admin-ajax.php",{action:"wpop_theme_save_options",data:a("#wpop-theme-settings *").not(".ignore").serialize()},function(d){WPop.flashMessage(d.text,d.type)},"json");return false})},doImport:function(b){WPop.flashMessage("Importing theme options, please wait &hellip;","loading");a.post("admin-ajax.php",{action:"wpop_theme_import_options",data:b},function(c){if(c){WPop.flashMessage(c.text,c.type)}if(c.type=="succeed"){document.location.replace("?page=wordspop-framework-theme")}},"json")}};WPop_CustomPermalink={$target:null,$select:null,$destination:null,$external:null,init:function(){var b=this;b.$target=a("select[name=custom_permalink_target]","#metabox-custom-permalink");b.$destination=a("input[name=custom_permalink_destination]","#metabox-custom-permalink");b.$select=a("select[name=custom_permalink_destination_select]","#metabox-custom-permalink");b.$external=a("input[name=custom_permalink_destination_external]","#metabox-custom-permalink");b.$select.parent("p").hide();b.$external.parent("p").hide();if(a(":selected",b.$target).val()!=""){b.options(a(":selected",b.$target).val())}b.$target.change(function(){b.options(a(":selected",this).val())});a("#post").submit(function(){if(a(":selected",b.$target).val()=="external"){b.$destination.val(b.$external.val())}else{b.$destination.val(a(":selected",b.$select).val())}})},options:function(c){var b=this;b.$select.parent("p").slideUp();if(c=="external"){b.$external.val(b.$destination.val());b.$external.parent("p").slideDown();return}else{b.$external.parent("p").slideUp()}a.getJSON("admin-ajax.php",{action:"wpop_get_permalink_destination",target:c},function(d){if(d==null){return}b.$select.empty();a.each(d,function(e,f){$option=a('<option value="'+e+'">'+f+"</option>\n");if(e==b.$destination.val()){$option.attr("selected","selected")}$option.appendTo(b.$select)});b.$select.parent("p").slideDown()})}};WPop_StylingBackground={init:function(){var b=this;a(".predefined-option span",".section-background").click(function(){b.set(this)})},set:function(e){$input=a(a(e).parents(".input").get(0));var c=a(e).css("background-color");if(c=="transparent"){c=""}a(".wpop-colorpicker",$input).children("div").css("background-color",c);a(".wpop-color",$input).val(c!=""?WPop_ColorPicker.RGBToHex(WPop_ColorPicker.maybeHEX(c)):c);var g=a(e).css("background-image");var d=g.replace(/"([^"]*)"/g,"$1").match(/\(([\S]+)\)/);if(d!=null){a(".upload-value",$input).val(d[1])}var b=a(e).css("background-position");if(b=="0% 0%"){b="left top"}if(b=="100% 0%"){b="right top"}if(b=="50% 0%"){b="center top"}if(b=="0% 100%"){b="left bottom"}if(b=="100% 100%"){b="right bottom"}if(b=="50% 100%"){b="center bottom"}if(b=="50% 50%"){b="center center"}if(b){a(".background-position",$input).val(b)}var f=a(e).css("background-repeat");if(f){a(".background-repeat",$input).val(f)}a(".predefined-option",$input).removeClass("current");a(a(e).parents(".predefined-option").get(0)).addClass("current");a(".upload-preview",$input).fadeOut()}};WPop_SlidesComposer={init:function(){a("select[name=tag_ID]","#wpop-compose-slides").change(function(){var b=a("option:selected",this).val();if(b){document.location.replace("./edit.php?post_type=slide&page=slides_composer&tag_ID="+b)}});a("#presentation-slide-list","#wpop-compose-slides").sortable({axis:"y",containment:"parent",items:".presentation-slide"})}};WPop={init:function(){a("#wpop_message").center();WPop_Nav.init();WPop_ColorPicker.init();WPop_Uploader.init();WPop_Scheme.init();WPop_StylingBackground.init();WPop_ThemeOptions.init();WPop_SlidesComposer.init();a(".input",".section-selector").WPopSelector();a("#wpop-container").show();a(window).bind("scroll resize load",function(){a("#wpop-message").center()})},flashMessage:function(d,c){var b=a("#wpop-message");a(b).html(d).center();a(b).removeClass("wpop-message-loading wpop-message-succeed wpop-message-error wpop-message-info");a(b).addClass("wpop-message-"+c);a(b).fadeIn("fast",function(){window.setTimeout(function(){a(b).fadeOut("fast")},3000)})}}})(jQuery);jQuery(document).ready(function(){WPop.init()});