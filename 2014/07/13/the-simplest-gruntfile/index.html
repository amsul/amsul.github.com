<!doctype html>

<html lang="en">


    <meta charset="utf-8">

    <meta name="author" content="Amsul - http://amsul.ca/">
    <meta name="copyright" content="&copy; Amsul">

    <meta name="viewport" content="width=device-width">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta http-equiv="cleartype" content="on">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    
        
            <title>The Simplest Gruntfile / Amsul</title>
        
    


    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,600italic,800italic,300,600,800">
    <link rel="stylesheet" href="/css/style.css">


    <script src="/js/shiv.js"></script>



    

        <div class="menu">
            <nav class="menu__nav" id="menu">
                <div class="content content--flat-bottom">
                    <a class="menu__button-close" href="#"></a>
                    <div class="content__box">
                        <h4 class="title--flat emphasize">Menu</h4>
                    </div>
                </div>
                <div class="content content-freeform content--pad-bottom">
                    <ul class="list--plain list--flat">
                        <li class="list__item">
                            <a class="link--block" href="/">
                                <div class="content">
                                    <div class="content__box content__box--pad-half">Home</div>
                                </div>
                            </a>
                        </li>
                        <li class="list__item">
                            <a class="link--block" href="/notepad">
                                <div class="content">
                                    <div class="content__box content__box--pad-half">Notepad</div>
                                </div>
                            </a>
                        </li>
                        <li class="list__item">
                            <a class="link--block" href="https://github.com/amsul?tab=repositories">
                                <div class="content">
                                    <div class="content__box content__box--pad-half">Projects</div>
                                </div>
                            </a>
                        </li>
                        <li class="list__item">
                            <a class="link--block" href="/me">
                                <div class="content">
                                    <div class="content__box content__box--pad-half">Me</div>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <aside class="menu__toggler alignright">
                <a class="menu__opener button-menu button-menu--inverse" href="#menu"></a>
                <a class="menu__closer button-menu button-menu--inverse" href="#"></a>
            </aside>
        </div> <!-- .menu -->

    


    <header class="header header--colored">
        <div class="content">
            <div class="content__box content__box--pad-one">
                
                    <h1 class="header__wrapper title--base-size title--thin title--flat">
                        
                            <a class="title--dimmed header__link" href="/">Hi, I&rsquo;m <b>Amsul</b>.</a>
                        
                    </h1>
                
                
                    <div class="header__title aligncenter">
                        
                            <p class="content__subtitle title--dimmed">July 13, 2014</p>
                        
                        
                            <h1 class="title title--thin title--flat">The Simplest Gruntfile</h1>
                        
                    </div>
                
            </div>
        </div>
    </header> <!-- .header -->


    <article class="content content--pad-bottom">
    <div class="content__box content__body">

        

            <p>More often than not, I’ve come across Gruntfiles that are monstrous configuration blocks that are difficult to digest. This is most likely an artifact of how the official guides suggest constructing a Gruntfile, to make it easy for beginners to get started with Grunt.js.</p>

<p>However, there is a much cleaner and modular approach we can take by separating the tasks and configurations into their own individual modules. What that ends up as is a tiny Gruntfile whose sole purpose is to load tasks from a directory and initialize them with configurations from another.</p>

<p>Here’s the Gruntfile in it’s entirety:</p>

<pre><code>/**
 * This Gruntfile is used to import configs and tasks
 * from the `node_configs` and `node_tasks` folders.
 */

'use strict';

module.exports = function(grunt) {
    initTasks(grunt, 'node_tasks')
    initConfigs(grunt, 'node_configs')
}

function initTasks(grunt, folderPath) {
    var pkg = grunt.file.readJSON('package.json')
    var tasks = pkg.devDependencies
    delete tasks.grunt
    for ( var task in tasks ) {
        grunt.loadNpmTasks(task)
    }
    grunt.loadTasks(folderPath)
}

function initConfigs(grunt, folderPath) {
    var config = {}
    grunt.file.expand(folderPath + '/**/*.js').forEach(function(filePath) {
        var fileName = filePath.split('/').pop().split('.')[0]
        var fileData = require('./' + filePath)
        config[fileName] = fileData
    })
    grunt.initConfig(config)
}
</code></pre>

<h3>The breakdown</h3>

<p>The first four lines are the gist of the work:</p>

<pre><code>module.exports = function(grunt) {
    initTasks(grunt, 'node_tasks')
    initConfigs(grunt, 'node_configs')
}
</code></pre>

<p>We first initialize tasks from the <code>node_tasks</code> directory and then we initialize configurations for those tasks from the <code>node_configs</code> directory.</p>

<h4><code>initTasks(grunt, folderPath)</code></h4>

<p>Within the <code>initTasks</code> function, we first read the <code>package.json</code> file:</p>

<pre><code>var pkg = grunt.file.readJSON('package.json')
</code></pre>

<p>...grab the <code>devDependencies</code>, which should only have Grunt tasks<sup><a href="#postscript_1">1</a></sup>:</p>

<pre><code>var tasks = pkg.devDependencies
delete tasks.grunt
</code></pre>

<p>...and load the named NPM tasks and our own custom tasks and aliases:</p>

<pre><code>for ( var task in tasks ) {
    grunt.loadNpmTasks(task)
}
grunt.loadTasks(folderPath)
</code></pre>

<h4><code>initConfigs(grunt, folderPath)</code></h4>

<p>Within the <code>initConfigs</code> function, we create an empty <code>config</code> object and glob through the <code>node_configs</code> directory:</p>

<pre><code>var config = {}
grunt.file.expand(folderPath + '/**/*.js').forEach(...)
</code></pre>

<p>...grab each file’s name, which should be the name of the task, and add it to the <code>config</code> object:</p>

<pre><code>var fileName = filePath.split('/').pop().split('.')[0]
var fileData = require('./' + filePath)
config[fileName] = fileData
</code></pre>

<p>...and finally, we initialize the configuration:</p>

<pre><code>grunt.initConfig(config)
</code></pre>

<h3>Setting up <code>node_configs</code> and <code>node_tasks</code></h3>

<p>These directories should look something like this:</p>

<pre><code>node_configs/
    ├── autoprefixer.js
    ├── connect.js
    ├── handlebars.js
    ├── jshint.js
    ├── less.js
    ├── uglify.js
    └── watch.js
node_tasks/
    ├── aliases.js
    ├── custom-task.js
    └── another-custom-task.js
</code></pre>

<p>Each task gets it’s own configuration file in <code>node_configs</code>:</p>

<pre><code>// node_configs/connect.js
'use strict';
var grunt = require('grunt')
module.exports = {
    options: {
        port: grunt.option('port') || 9001
    },
    server: {
        // ...
    }
}
</code></pre>

<p>Each custom task gets it’s own registration file in <code>node_tasks</code>:</p>

<pre><code>// node_tasks/custom-task.js
'use strict';
module.exports = function(grunt) {
    grunt.registerMultiTask('custom-task', 'Make Grunt do something custom', function() {
        // ...
    })
}
</code></pre>

<p>And all the task aliases, such as the default task, live in <code>node_tasks/aliases.js</code>:</p>

<pre><code>'use strict';
module.exports = function(grunt) {
    grunt.registerTask('default', ['less', 'autoprefixer'])
    grunt.registerTask('server', ['connect', 'watch'])
}
</code></pre>

<h3>Brilliant <img alt="bowtie" src="https://github.global.ssl.fastly.net/images/icons/emoji/bowtie.png" class="emoji" /></h3>

<p>I’ve found this to be much more flexible and extremely simple to find your way around all the tasks and configurations for complex build steps.</p>


            
                <hr>
                <footer class="content__postscript">
                    <ol>
                        
                            <li class="content__postscript-item" id="postscript_1">
                                <a class="content__postscript-hook"
                                    href="#postscript_1"
                                    name="postscript_1"></a>
                                <p>Any dependencies that aren’t Grunt tasks can be listed under <code>dependencies</code>, otherwise Grunt will try to load it as a task and fail.</p>

                            </li>
                        
                    </ol>
                </footer>
            

        

    </div>
</article>


    

        <footer class="footer gui-flip">
            <div class="content">
                
                    <div class="content__box content__box--flat-top">
                        <a class="button-block" href="https://twitter.com/intent/tweet?text=@amsul_&url=http%3A%2F%2Famsul.ca%2F2014%2F07%2F13%2Fthe-simplest-gruntfile%2F" target="_blank">Share your comments/questions</a>
                    </div>
                    <div class="content__box content__box--flat">
                        
                            <a class="button-block" href="/">Back to home</a>
                        
                    </div>
                
                <div class="content__box aligncenter">
                    <ul class="list--plain list--inline">
                        <li class="list__item">
                            <a class="button-cube" href="http://twitter.com/amsul_" target="_blank">
                                <span class="gui-icon gui-icon--twitter"></span>
                            </a>
                        </li><!--
                     --><li class="list__item">
                            <a class="button-cube" href="http://github.com/amsul" target="_blank">
                                <span class="gui-icon gui-icon--github"></span>
                            </a>
                        </li><!--
                     --><li class="list__item">
                            <a class="button-cube" href="mailto:reach@amsul.ca">
                                <span class="gui-icon gui-icon--email"></span>
                            </a>
                        </li>
                    </ul>
                    <p>&copy; 2014 Amsul</p>
                    <p class="peace">&#x270C;</p>
                    <p class="embrace">Embrace the randomness.</p>
                </div>
            </div>
        </footer> <!-- .footer -->

    


    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-34739744-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>


</html>


