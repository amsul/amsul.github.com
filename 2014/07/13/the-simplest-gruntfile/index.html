<!doctype html>

<html lang="en">


    <meta charset="utf-8">

    <meta name="author" content="Amsul - http://amsul.ca/">
    <meta name="copyright" content="&copy; Amsul">
    

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@amsul_">
    <meta name="twitter:domain" content="amsul.ca">
    <meta name="twitter:creator" content="@amsul_">
    
        
            <meta name="twitter:title" content="The Simplest Gruntfile / Amsul">
        
    
    

    <meta name="viewport" content="width=device-width">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta http-equiv="cleartype" content="on">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    
        
            <title>The Simplest Gruntfile / Amsul</title>
        
    


    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,600italic,800italic,300,600,800">
    <link rel="stylesheet" href="/css/style.css">


    <script src="/js/shiv.js"></script>


    

    <div class="menu">
        <nav class="menu__nav" id="menu">
            <div class="content content--flat-bottom">
                <a class="menu__button-close" href="#"></a>
                <div class="content__box">
                    <h4 class="title--flat emphasize">Menu</h4>
                </div>
            </div>
            <div class="content content-freeform content--pad-bottom">
                <ul class="list--plain list--flat">
                    <li class="list__item">
                        <a class="link--block" href="/">
                            <div class="content">
                                <div class="content__box content__box--pad-half">Home</div>
                            </div>
                        </a>
                    </li>
                    <li class="list__item">
                        <a class="link--block" href="/notepad">
                            <div class="content">
                                <div class="content__box content__box--pad-half">Notepad</div>
                            </div>
                        </a>
                    </li>
                    <li class="list__item">
                        <a class="link--block" href="https://github.com/amsul?tab=repositories">
                            <div class="content">
                                <div class="content__box content__box--pad-half">Projects</div>
                            </div>
                        </a>
                    </li>
                    <li class="list__item">
                        <a class="link--block" href="/me">
                            <div class="content">
                                <div class="content__box content__box--pad-half">Me</div>
                            </div>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <aside class="menu__toggler alignright">
            <a class="menu__opener button-menu button-menu--inverse" href="#menu"></a>
            <a class="menu__closer button-menu button-menu--inverse" href="#"></a>
        </aside>
    </div> <!-- .menu -->




<header class="header header--colored">
    <div class="content">
        <div class="content__box content__box--pad-one">
            
                <h1 class="header__wrapper title--base-size title--thin title--flat">
                    <a class="header__link header__link--dimmed title--dimmed" href="#menu">
                        
                            Hi, I&rsquo;m <b>Amsul</b>.
                        
                    </a>
                </h1>
            
            
                <div class="header__title aligncenter">
                    
                        <p class="content__subtitle title--dimmed">July 13, 2014</p>
                    
                    
                        <h1 class="title title--thin title--flat">The Simplest Gruntfile</h1>
                    
                </div>
            
        </div>
    </div>
</header> <!-- .header -->


<article class="content content--pad-bottom">
    <div class="content__box content__body">

        

            <p>More often than not, I’ve come across Gruntfiles that are monstrous configuration blocks that are difficult to digest. This is most likely an artifact of how the official guides suggest constructing a Gruntfile, to make it easy for beginners to get started with Grunt.js.</p>

<p>However, there is a much cleaner and modular approach we can take by separating the tasks and configurations into their own individual modules. What that ends up as is a tiny Gruntfile whose sole purpose is to load tasks from a directory and initialize them with configurations from another.</p>

<p>Here’s the Gruntfile in it’s entirety:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**</span>
<span class="cm"> * This Gruntfile is used to import configs and tasks</span>
<span class="cm"> * from the `node_configs` and `node_tasks` folders.</span>
<span class="cm"> */</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">initTasks</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="s1">&#39;node_tasks&#39;</span><span class="p">)</span>
    <span class="nx">initConfigs</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="s1">&#39;node_configs&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initTasks</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="nx">folderPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pkg</span> <span class="o">=</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">tasks</span> <span class="o">=</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">devDependencies</span>
    <span class="k">delete</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">grunt</span>
    <span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">task</span> <span class="k">in</span> <span class="nx">tasks</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">(</span><span class="nx">folderPath</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">initConfigs</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="nx">folderPath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">expand</span><span class="p">(</span><span class="nx">folderPath</span> <span class="o">+</span> <span class="s1">&#39;/**/*.js&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="nx">filePath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="kd">var</span> <span class="nx">fileData</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./&#39;</span> <span class="o">+</span> <span class="nx">filePath</span><span class="p">)</span>
        <span class="nx">config</span><span class="p">[</span><span class="nx">fileName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fileData</span>
    <span class="p">})</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3>The breakdown</h3>

<p>The first four lines are the gist of the work:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">initTasks</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="s1">&#39;node_tasks&#39;</span><span class="p">)</span>
    <span class="nx">initConfigs</span><span class="p">(</span><span class="nx">grunt</span><span class="p">,</span> <span class="s1">&#39;node_configs&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>We first initialize tasks from the <code>node_tasks</code> directory and then we initialize configurations for those tasks from the <code>node_configs</code> directory.</p>

<h4><code>initTasks(grunt, folderPath)</code></h4>

<p>Within the <code>initTasks</code> function, we first read the <code>package.json</code> file:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">pkg</span> <span class="o">=</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">)</span>
</code></pre></div>
<p>&hellip;grab the <code>devDependencies</code>, which should only have Grunt tasks<sup><a href="#postscript_1">1</a>:</sup></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">tasks</span> <span class="o">=</span> <span class="nx">pkg</span><span class="p">.</span><span class="nx">devDependencies</span>
<span class="k">delete</span> <span class="nx">tasks</span><span class="p">.</span><span class="nx">grunt</span>
</code></pre></div>
<p>&hellip;and load the named NPM tasks and our own custom tasks and aliases:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="k">for</span> <span class="p">(</span> <span class="kd">var</span> <span class="nx">task</span> <span class="k">in</span> <span class="nx">tasks</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="nx">task</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">grunt</span><span class="p">.</span><span class="nx">loadTasks</span><span class="p">(</span><span class="nx">folderPath</span><span class="p">)</span>
</code></pre></div>
<h4><code>initConfigs(grunt, folderPath)</code></h4>

<p>Within the <code>initConfigs</code> function, we create an empty <code>config</code> object and glob through the <code>node_configs</code> directory:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">expand</span><span class="p">(</span><span class="nx">folderPath</span> <span class="o">+</span> <span class="s1">&#39;/**/*.js&#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(...)</span>
</code></pre></div>
<p>&hellip;grab each file’s name, which should be the name of the task, and add it to the <code>config</code> object:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="nx">filePath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="kd">var</span> <span class="nx">fileData</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./&#39;</span> <span class="o">+</span> <span class="nx">filePath</span><span class="p">)</span>
<span class="nx">config</span><span class="p">[</span><span class="nx">fileName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fileData</span>
</code></pre></div>
<p>&hellip;and finally, we initialize the configuration:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
</code></pre></div>
<h3>Setting up <code>node_configs</code> and <code>node_tasks</code></h3>

<p>These directories should look something like this:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">node_configs/
    ├── autoprefixer.js
    ├── connect.js
    ├── handlebars.js
    ├── jshint.js
    ├── less.js
    ├── uglify.js
    └── watch.js
node_tasks/
    ├── aliases.js
    ├── custom-task.js
    └── another-custom-task.js
</code></pre></div>
<p>Each task gets it’s own configuration file in <code>node_configs</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// node_configs/connect.js</span>
<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">grunt</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;grunt&#39;</span><span class="p">)</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">port</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">9001</span>
    <span class="p">},</span>
    <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Each custom task gets it’s own registration file in <code>node_tasks</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// node_tasks/custom-task.js</span>
<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerMultiTask</span><span class="p">(</span><span class="s1">&#39;custom-task&#39;</span><span class="p">,</span> <span class="s1">&#39;Make Grunt do something custom&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">})</span>
<span class="p">}</span>
</code></pre></div>
<p>And all the task aliases, such as the default task, live in <code>node_tasks/aliases.js</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;less&#39;</span><span class="p">,</span> <span class="s1">&#39;autoprefixer&#39;</span><span class="p">])</span>
    <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;server&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="s1">&#39;watch&#39;</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div>
<h3>Brilliant <img alt="bowtie" src="https://github.githubassets.com/images/icons/emoji/bowtie.png" class="emoji" /></h3>

<p>I’ve found this to be much more flexible and extremely simple to find your way around all the tasks and configurations for complex build steps.</p>


            
                <footer class="content__postscript">
                    <h4>Footnotes</h4>
                    <ol>
                        
                            <li class="content__postscript-item" id="postscript_1">
                                <a class="content__postscript-hook"
                                    href="#postscript_1"
                                    name="postscript_1"></a>
                                <p>Any dependencies that aren’t Grunt tasks can be listed under <code>dependencies</code>, otherwise Grunt will try to load it as a task and fail.</p>

                            </li>
                        
                    </ol>
                </footer>
            

        

    </div>
</article>





    <footer class="footer gui-flip">
        <div class="content">
            
                <div class="content__box content__box--flat">
                    
                        <a class="button-block" href="/">Back to home</a>
                    
                </div>
            
            <div class="content__box aligncenter">
                <ul class="list--plain list--inline">
                    <li class="list__item">
                        <a class="button-cube" href="http://twitter.com/amsul_" target="_blank">
                            <span class="gui-icon gui-icon--twitter"></span>
                        </a>
                    </li><!--
                 --><li class="list__item">
                        <a class="button-cube" href="http://github.com/amsul" target="_blank">
                            <span class="gui-icon gui-icon--github"></span>
                        </a>
                    </li><!--
                 --><li class="list__item">
                        <a class="button-cube" href="mailto:reach@amsul.ca">
                            <span class="gui-icon gui-icon--email"></span>
                        </a>
                    </li>
                </ul>
                <p>&copy; 2019 Amsul</p>
                <p class="peace">&#x270C;</p>
                <p class="embrace">Embrace the randomness.</p>
            </div>
        </div>
    </footer> <!-- .footer -->





    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-34739744-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>


</html>


